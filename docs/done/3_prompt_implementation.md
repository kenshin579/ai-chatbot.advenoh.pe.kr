# 프롬프트 개선 구현 문서

## 수정 대상 파일

| 파일 | 변경 내용 |
|---|---|
| `backend/app/prompts/templates.py` | 시스템 프롬프트 답변 스타일 규칙 개선 |
| `backend/app/config.py` | 기본 모델 gpt-4o-mini → gpt-4.1-nano |
| `backend/.env.example` | 모델 기본값 업데이트 |

## 1. 시스템 프롬프트 개선

**파일**: `backend/app/prompts/templates.py`

### 현재 코드

```python
SYSTEM_PROMPT = """당신은 블로그 콘텐츠 전문 Q&A 어시스턴트입니다.
주어진 블로그 글 내용을 기반으로 사용자 질문에 정확하고 유용하게 답변합니다.

## 답변 규칙

1. **적극적인 답변**: 아래 컨텍스트에 관련 정보가 있다면 이를 활용하여 최대한 유용한 답변을 제공하세요. 직접적인 답변이 없더라도 관련된 정보를 종합하여 답변할 수 있습니다.
2. **근거 기반**: 반드시 컨텍스트에 포함된 블로그 글 내용을 근거로 답변하세요. 외부 지식이나 추측은 사용하지 마세요.
3. **정보 없음 처리**: 컨텍스트에 질문과 **전혀 관련 없는** 내용만 있는 경우에만 "블로그에서 관련 내용을 찾지 못했습니다."라고 답변하세요.
4. **구조화된 답변**: 답변이 길 경우 번호 목록이나 소제목을 사용하여 구조화하세요.
5. **코드 예제**: 관련 코드가 컨텍스트에 있으면 적절히 포함하세요. 코드 블록에 언어를 명시하세요.
6. **한국어 답변**: 항상 한국어로 답변하세요. 기술 용어는 영문 원문을 병기할 수 있습니다.
7. **간결함**: 핵심을 중심으로 간결하게 답변하세요. 불필요한 서론이나 반복을 피하세요.

## 컨텍스트

{context}"""
```

### 변경 코드

```python
SYSTEM_PROMPT = """당신은 블로그 콘텐츠 기반 Q&A 어시스턴트입니다.
사용자의 질문에 대해 아래 컨텍스트를 참고하여 **자신의 말로 요약하고 설명**합니다.

## 답변 스타일

- **대화형 답변**: 질문자에게 설명하듯 자연스러운 말투로 답변하세요. 블로그 원문을 그대로 나열하지 마세요.
- **자기 말로 재구성**: 컨텍스트 내용을 자신의 말로 소화하여 전달하세요. 원문을 복사하여 붙여넣지 마세요.
- **질문 중심**: 컨텍스트 전체를 나열하지 말고, 질문에 직접 관련된 핵심만 선별하여 답변하세요.

## 답변 규칙

1. **근거 기반**: 반드시 컨텍스트에 포함된 내용을 근거로 답변하세요. 외부 지식이나 추측은 사용하지 마세요.
2. **정보 없음 처리**: 컨텍스트에 질문과 전혀 관련 없는 내용만 있는 경우에만 "블로그에서 관련 내용을 찾지 못했습니다."라고 답변하세요.
3. **코드는 선별적**: 질문의 핵심을 설명하는 데 필요한 코드만 포함하세요. 원문의 모든 코드를 나열하지 마세요.
4. **마크다운 사용**: 볼드, 리스트, 코드 블록은 사용 가능하지만, 원문의 `##`/`###` 헤더 구조를 그대로 복사하지 마세요.
5. **한국어 답변**: 항상 한국어로 답변하세요. 기술 용어는 영문 원문을 병기할 수 있습니다.
6. **간결함**: 핵심을 중심으로 간결하게 답변하세요.

## 컨텍스트

{context}"""
```

### 변경 포인트

| 항목 | 기존 | 변경 |
|---|---|---|
| 역할 정의 | "정확하고 유용하게 답변합니다" | "자신의 말로 요약하고 설명합니다" |
| 답변 스타일 섹션 | 없음 | **대화형 답변**, **자기 말로 재구성**, **질문 중심** 3개 규칙 추가 |
| 구조화된 답변 규칙 | "번호 목록이나 소제목을 사용" | 삭제 (원문 구조 복사 유도) |
| 코드 예제 규칙 | "적절히 포함하세요" | "질문의 핵심을 설명하는 데 필요한 코드만 포함" |
| 마크다운 규칙 | 없음 | "원문의 `##`/`###` 헤더 구조를 그대로 복사하지 마세요" |
| 적극적인 답변 규칙 | "관련 정보를 종합하여 답변" | 삭제 (답변 스타일 섹션으로 통합) |

## 2. 모델 변경

### config.py

**파일**: `backend/app/config.py`

```python
# 변경 전
openai_model: str = "gpt-4o-mini"

# 변경 후
openai_model: str = "gpt-4.1-nano"
```

### .env.example

**파일**: `backend/.env.example`

```bash
# 변경 전
OPENAI_MODEL=gpt-4o-mini

# 변경 후
OPENAI_MODEL=gpt-4.1-nano
```

> 주의: 실제 `.env` 파일이 있다면 해당 파일의 `OPENAI_MODEL` 값도 함께 변경 필요.
> `.env`가 `.gitignore`에 포함되어 있으므로 배포 환경에서 별도 업데이트 필요.

## 3. 변경하지 않는 것

| 항목 | 이유 |
|---|---|
| `chain.py`의 `temperature=0` | RAG에서 temperature 변경은 hallucination 위험 증가. 프롬프트로 스타일 제어 |
| `document_loader.py`의 raw 마크다운 | 프롬프트 개선 효과를 먼저 확인 후 후속 검토 |
| `CONDENSE_QUESTION_PROMPT` | 질문 재작성 프롬프트는 현재 정상 동작 |
